import{j as i,m as u,r as y,A as ce}from"./index-DP6_JRtg.js";import{a as k,g as h}from"./universalTheme-DqOPmelH.js";const le=({node:c,index:d,position:t,isCurrent:p,isNightMode:A,hoveredNode:x,yinYangHoverSide:B,onHover:q,onHoverEnd:b,onToggleTime:S,onNavigate:R,onClose:z})=>{const T=(f,M)=>{if(M)S();else{const $=t.x,F=f<$;R(c.id),setTimeout(()=>{(F&&!A||!F&&A)&&S()},100)}},E={fill:"white",fontSize:"10px",textAnchor:"middle",dominantBaseline:"middle",pointerEvents:"none"},v=()=>{if(B==="yin"){const $=k("memories");return h($.themeId).colors.primary}else if(B==="yang"){const $=k("techno");return h($.themeId).colors.primary}const f=k("techno");return h(f.themeId).colors.primary},a=p?20:15,C=k("techno"),I=h(C.themeId),Y=k("memories"),j=h(Y.themeId);return i.jsxs("g",{children:[i.jsxs("defs",{children:[i.jsxs("linearGradient",{id:`yangGradient-${c.id}`,x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[i.jsx("stop",{offset:"0%",stopColor:I.colors.primary}),i.jsx("stop",{offset:"100%",stopColor:I.colors.tertiary||I.colors.primary})]}),i.jsxs("linearGradient",{id:`yinGradient-${c.id}`,x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[i.jsx("stop",{offset:"0%",stopColor:j.colors.primary}),i.jsx("stop",{offset:"100%",stopColor:j.colors.secondary||j.colors.primary})]})]}),i.jsx(u.path,{d:`M ${t.x-a} ${t.y}
            A ${a} ${a} 0 0 1 ${t.x} ${t.y-a}
            A ${a} ${a} 0 0 1 ${t.x} ${t.y+a}
            Z`,fill:"transparent",style:{cursor:"pointer"},onMouseEnter:()=>q(c.id,"yin"),onMouseLeave:()=>b(),onClick:f=>{if(f.stopPropagation(),p)A||S();else{const M=f.target.getBoundingClientRect(),$=f.clientX-M.left;T($,p)}},animate:{d:`M ${t.x-a} ${t.y}
              A ${a} ${a} 0 0 1 ${t.x} ${t.y-a}
              A ${a} ${a} 0 0 1 ${t.x} ${t.y+a}
              Z`},transition:{duration:.6,ease:"easeInOut"}}),i.jsx(u.path,{d:`M ${t.x} ${t.y-a}
            A ${a} ${a} 0 0 1 ${t.x+a} ${t.y}
            A ${a} ${a} 0 0 1 ${t.x} ${t.y+a}
            Z`,fill:"transparent",style:{cursor:"pointer"},onMouseEnter:()=>q(c.id,"yang"),onMouseLeave:()=>b(),onClick:f=>{if(f.stopPropagation(),p)A&&S();else{const M=f.target.getBoundingClientRect(),$=f.clientX-M.left;T($,p)}},animate:{d:`M ${t.x} ${t.y-a}
              A ${a} ${a} 0 0 1 ${t.x+a} ${t.y}
              A ${a} ${a} 0 0 1 ${t.x} ${t.y+a}
              Z`},transition:{duration:.6,ease:"easeInOut"}}),i.jsx(u.circle,{cx:t.x,cy:t.y,r:a,fill:`url(#yangGradient-${c.id})`,stroke:p?"white":"rgba(255, 255, 255, 0.3)",strokeWidth:p?3:2,style:{cursor:"pointer",pointerEvents:"none"},initial:{scale:0},animate:{scale:1,cx:t.x,cy:t.y,r:a},transition:{scale:{delay:d*.1},cx:{duration:.6,ease:"easeInOut"},cy:{duration:.6,ease:"easeInOut"},r:{duration:.3,ease:"easeInOut"}}}),i.jsx(u.path,{d:`M ${t.x} ${t.y-a}
            A ${a} ${a} 0 0 0 ${t.x} ${t.y+a}
            A ${a/2} ${a/2} 0 0 0 ${t.x} ${t.y}
            A ${a/2} ${a/2} 0 0 1 ${t.x} ${t.y-a}
            Z`,fill:`url(#yinGradient-${c.id})`,style:{pointerEvents:"none"},initial:{scale:0},animate:{scale:1,d:`M ${t.x} ${t.y-a}
              A ${a} ${a} 0 0 0 ${t.x} ${t.y+a}
              A ${a/2} ${a/2} 0 0 0 ${t.x} ${t.y}
              A ${a/2} ${a/2} 0 0 1 ${t.x} ${t.y-a}
              Z`},transition:{scale:{delay:d*.1},d:{duration:.6,ease:"easeInOut"}}}),i.jsx(u.circle,{cx:t.x,cy:t.y-a/2,r:a/5,fill:`url(#yinGradient-${c.id})`,style:{pointerEvents:"none"},initial:{scale:0},animate:{scale:1,cx:t.x,cy:t.y-a/2,r:a/5},transition:{scale:{delay:d*.1+.1},cx:{duration:.6,ease:"easeInOut"},cy:{duration:.6,ease:"easeInOut"},r:{duration:.3,ease:"easeInOut"}}}),i.jsx(u.circle,{cx:t.x,cy:t.y+a/2,r:a/5,fill:`url(#yangGradient-${c.id})`,style:{pointerEvents:"none"},initial:{scale:0},animate:{scale:1,cx:t.x,cy:t.y+a/2,r:a/5},transition:{scale:{delay:d*.1+.1},cx:{duration:.6,ease:"easeInOut"},cy:{duration:.6,ease:"easeInOut"},r:{duration:.3,ease:"easeInOut"}}}),i.jsx(u.text,{x:t.x,y:t.y+30,style:E,initial:{opacity:0},animate:{opacity:1,x:t.x,y:t.y+30},transition:{opacity:{delay:d*.1+.2},x:{duration:.6,ease:"easeInOut"},y:{duration:.6,ease:"easeInOut"}},children:c.title.length>12?c.title.substring(0,12)+"...":c.title}),x===c.id&&i.jsx(u.circle,{cx:t.x,cy:t.y,r:a,fill:"none",stroke:v(),strokeWidth:3,opacity:.8,initial:{scale:1,opacity:0},animate:{scale:p?1.2:1.4,opacity:.8,cx:t.x,cy:t.y},transition:{scale:{duration:.2},opacity:{duration:.2},cx:{duration:.6,ease:"easeInOut"},cy:{duration:.6,ease:"easeInOut"}}}),p&&i.jsx(u.circle,{cx:t.x,cy:t.y,r:a,fill:"none",stroke:"rgba(255, 255, 255, 0.6)",strokeWidth:2,opacity:.3,animate:{r:[a,a+10,a],opacity:[.3,0,.3],cx:t.x,cy:t.y},transition:{r:{duration:2,repeat:1/0},opacity:{duration:2,repeat:1/0},cx:{duration:.6,ease:"easeInOut"},cy:{duration:.6,ease:"easeInOut"}}})]})},ue=({memoryGraph:c,currentNode:d,onNavigate:t,onEnterSubGraph:p,onExitSubGraph:A,navigationPath:x,isNightMode:B,onToggleTime:q})=>{const[b,S]=y.useState(!1),[R,z]=y.useState([]),[T,E]=y.useState(null),[v,a]=y.useState(null),[C,I]=y.useState(0),[Y,j]=y.useState(null),[f,M]=y.useState({}),[$,F]=y.useState(d),Z=y.useCallback(e=>{const n=k(e);return h(n.themeId)},[]);y.useCallback(e=>{const n=k(e);return h(n.themeId)},[]);const W=y.useCallback((e,n,s)=>{if(!e||Object.keys(e).length<=1||Object.keys(e).filter(w=>w!==s).length===0)return 60;const O=70+15+8;return Math.max(O,60)},[]),G=y.useCallback(()=>W(c.nodes,c.edges,d),[c.nodes,c.edges,d,W]),H=y.useCallback(e=>{try{return h(e).colors.primary}catch{try{const s=k(e);if(s)return h(s.themeId).colors.primary}catch{return"#6b7280"}return"#6b7280"}},[]),V=y.useCallback(e=>{if(e==="techno"){if(v==="yin")try{const n=k("techno"),s=h(n.themeId);return s.colors.secondary||s.colors.primary}catch{return"#8b5cf6"}else if(v==="yang")try{const n=k("techno");return h(n.themeId).colors.primary}catch{return"#facc15"}}return H(e)},[v,H]),J=y.useCallback(e=>{try{const n=k(e);if(n){const s=h(n.themeId);return s.colors.bgOpacity40||`${s.colors.primary}40`}}catch{}try{const n=h(e);return n.colors.bgOpacity40||`${n.colors.primary}40`}catch{return"rgba(107, 114, 128, 0.4)"}},[Z]);y.useEffect(()=>{const e=c.nodes[d],n=c.edges[d]||[],s=[e];if(n.forEach(r=>{c.nodes[r]&&s.push(c.nodes[r])}),z(s),$!==d&&x.length>0){const r={};s.forEach((l,o)=>{r[l.id]=L(l.id,o,s.length)}),M(r),F(d)}if(x.length>1){const r=x[x.length-1];if(r&&C===0){j(r);const l=G();I(l)}}else C>0&&(I(0),j(null))},[d,c,x,$]);const L=y.useCallback((e,n,s)=>{if(e===d)return{x:180,y:120};const r=n*2*Math.PI/(s-1),l=70;return{x:180+Math.cos(r)*l,y:120+Math.sin(r)*l}},[d]),P=y.useCallback((e,n,s)=>f[e]?f[e]:L(e,n,s),[f,L]),D=y.useCallback(e=>{const n=c.nodes[e];e===d&&n.subGraph?K(n,()=>{p(e)}):e!==d&&t(e)},[c.nodes,d,p,t]),K=(e,n)=>{j(e.id),I(0);let s=80;if(e.subGraph&&e.subGraph.nodes){const g=`${e.id}-hub`,O=e.subGraph.nodes[g]?g:Object.keys(e.subGraph.nodes)[0];s=W(e.subGraph.nodes,e.subGraph.edges,O)}let r,l=null;const o=800,m=g=>{l||(l=g);const O=g-l,w=Math.min(O/o,1),X=(1-Math.pow(1-w,3))*s;I(X),w<1?r=requestAnimationFrame(m):n()};return r=requestAnimationFrame(m),()=>{r&&cancelAnimationFrame(r)}},Q=(e,n)=>{j(e);const s=C;let r,l=null;const o=600,m=g=>{l||(l=g);const O=g-l,w=Math.min(O/o,1),N=Math.pow(w,2),X=s*(1-N);I(X),w<1?r=requestAnimationFrame(m):(I(0),j(null),setTimeout(()=>{n()},100))};return r=requestAnimationFrame(m),()=>{r&&cancelAnimationFrame(r)}},U=e=>{if(!b||e.target.tagName==="circle"||e.target.tagName==="text"||e.target.tagName==="g")return;e.currentTarget.getBoundingClientRect();const n=180,s=120,r=e.nativeEvent.offsetX,l=e.nativeEvent.offsetY,o=Math.sqrt(Math.pow(r-n,2)+Math.pow(l-s,2)),m=C-10;if(o>m&&x.length>1)if(c.nodes[d]){const O=x[x.length-1];Q(O,()=>{A()})}else A();else x.length===1&&o>120&&S(!1)},_=(e,n)=>{E(e),a(n)},ee=()=>{E(null),a(null)},te={position:"fixed",top:"20px",right:"20px",zIndex:100,width:"50px",height:"50px",borderRadius:"50%",backgroundColor:b?"rgba(250, 204, 21, 0.2)":"rgba(0, 0, 0, 0.7)",border:`2px solid ${b?h("yellow-techno").colors.primary:"rgba(255, 255, 255, 0.3)"}`,color:b?h("yellow-techno").colors.primary:"white",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"20px",backdropFilter:"blur(10px)",transition:"all 0.3s ease",boxShadow:b?`0 0 20px ${h("yellow-techno").colors.primary}30`:"none"},ae={position:"fixed",top:"80px",right:"20px",width:"360px",height:"240px",backgroundColor:"rgba(0, 0, 0, 0.9)",border:"1px solid rgba(255, 255, 255, 0.2)",borderRadius:"12px",padding:"20px",zIndex:99,backdropFilter:"blur(20px)"},se={width:"100%",height:"100%"},ne={cursor:"pointer"},re={stroke:"rgba(255, 255, 255, 0.3)",strokeWidth:2},ie={fill:"white",fontSize:"10px",textAnchor:"middle",dominantBaseline:"middle",pointerEvents:"none"};return i.jsxs(i.Fragment,{children:[i.jsx(u.div,{style:te,onClick:()=>S(!b),whileHover:{scale:1.1},whileTap:{scale:.95},children:i.jsx(u.div,{animate:{rotate:b?45:0},transition:{duration:.2},children:"⚡"})}),i.jsx(ce,{children:b&&i.jsxs(i.Fragment,{children:[x.length>1&&i.jsxs(u.div,{style:{position:"fixed",top:"40px",right:"20px",backgroundColor:"rgba(0, 0, 0, 0.8)",border:"1px solid rgba(255, 255, 255, 0.2)",borderRadius:"8px",padding:"8px 12px",zIndex:98,backdropFilter:"blur(10px)",fontSize:"12px",color:"white",fontFamily:"monospace"},initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},children:[i.jsxs("div",{style:{marginBottom:"4px",opacity:.7},children:["Level ",x.length-1]}),i.jsxs("div",{children:["Path: ",x.slice(1).join(" → ")]})]}),i.jsx(u.div,{style:ae,initial:{opacity:0,scale:.8,y:-20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.8,y:-20},transition:{duration:.2},children:i.jsxs("svg",{style:se,onClick:U,children:[C>0&&Y&&i.jsx(u.circle,{cx:180,cy:120,r:C,fill:J(Y),stroke:H(Y),strokeWidth:"2",opacity:x.length>1?.3:.8,style:{pointerEvents:"none"},strokeDasharray:x.length>1?"5,5":"none",animate:x.length>1?{strokeDashoffset:[0,-10],opacity:[.3,.4,.3]}:{},transition:x.length>1?{strokeDashoffset:{duration:2,repeat:1/0,ease:"linear"},opacity:{duration:3,repeat:1/0,ease:"easeInOut"}}:{}}),R.map((e,n)=>R.map((s,r)=>{if(n>=r)return null;const l=c.edges[e.id]?.includes(s.id),o=c.edges[s.id]?.includes(e.id);if(!l&&!o)return null;const m=P(e.id,n,R.length),g=P(s.id,r,R.length);return i.jsx(u.line,{x1:m.x,y1:m.y,x2:g.x,y2:g.y,style:re,initial:{pathLength:0},animate:{pathLength:1,x1:m.x,y1:m.y,x2:g.x,y2:g.y},transition:{pathLength:{delay:.3+(n+r)*.05,duration:.5},x1:{duration:.6,ease:"easeInOut"},y1:{duration:.6,ease:"easeInOut"},x2:{duration:.6,ease:"easeInOut"},y2:{duration:.6,ease:"easeInOut"}}},`edge-${e.id}-${s.id}`)})).flat().filter(Boolean),R.map((e,n)=>{const s=P(e.id,n,R.length),r=e.id===d,l=H(e.theme);return e.id==="techno"?i.jsx(le,{node:e,index:n,position:s,isCurrent:r,isNightMode:B,hoveredNode:T,yinYangHoverSide:v,onHover:_,onHoverEnd:ee,onToggleTime:q,onNavigate:t,onClose:()=>{}},e.id):i.jsxs("g",{children:[i.jsx(u.circle,{cx:s.x,cy:s.y,r:r?20:15,fill:l,stroke:r?"white":"rgba(255, 255, 255, 0.5)",strokeWidth:r?3:2,style:ne,onClick:o=>{o.stopPropagation(),D(e.id)},onMouseEnter:()=>E(e.id),onMouseLeave:()=>E(null),initial:{scale:0},animate:{scale:1,cx:s.x,cy:s.y,r:r?20:15},transition:{scale:{delay:n*.1},cx:{duration:.6,ease:"easeInOut"},cy:{duration:.6,ease:"easeInOut"},r:{duration:.3,ease:"easeInOut"}},whileTap:{scale:.9}}),i.jsx(u.text,{x:s.x,y:s.y+30,style:ie,onClick:o=>{o.stopPropagation(),D(e.id)},initial:{opacity:0},animate:{opacity:1,x:s.x,y:s.y+30},transition:{opacity:{delay:n*.1+.2},x:{duration:.6,ease:"easeInOut"},y:{duration:.6,ease:"easeInOut"}},children:e.title.length>12?e.title.substring(0,12)+"...":e.title}),e.subGraph&&i.jsxs("g",{children:[[0,1,2].map(o=>i.jsx(u.circle,{cx:s.x+Math.cos(o*2*Math.PI/3)*(r?28:23),cy:s.y+Math.sin(o*2*Math.PI/3)*(r?28:23),r:2,fill:"white",opacity:.9,initial:{scale:0},animate:{scale:1,cx:s.x+Math.cos(o*2*Math.PI/3)*(r?28:23),cy:s.y+Math.sin(o*2*Math.PI/3)*(r?28:23)},transition:{scale:{delay:n*.1+.4+o*.1},cx:{duration:.6,ease:"easeInOut"},cy:{duration:.6,ease:"easeInOut"}}},`subgraph-indicator-${o}`)),r&&i.jsx(u.circle,{cx:s.x,cy:s.y,r:25,fill:"none",stroke:"yellow",strokeWidth:2,opacity:.6,animate:{r:[25,35,25],opacity:[.6,.2,.6],cx:s.x,cy:s.y},transition:{r:{duration:1.5,repeat:1/0},opacity:{duration:1.5,repeat:1/0},cx:{duration:.6,ease:"easeInOut"},cy:{duration:.6,ease:"easeInOut"}}})]}),T===e.id&&i.jsx(u.circle,{cx:s.x,cy:s.y,r:r?20:15,fill:"none",stroke:V(e.id),strokeWidth:3,opacity:.8,initial:{scale:1,opacity:0},animate:{scale:r?1.2:1.4,opacity:.8,cx:s.x,cy:s.y},transition:{scale:{duration:.2},opacity:{duration:.2},cx:{duration:.6,ease:"easeInOut"},cy:{duration:.6,ease:"easeInOut"}}}),r&&i.jsx(u.circle,{cx:s.x,cy:s.y,r:20,fill:"none",stroke:l,strokeWidth:2,opacity:.3,animate:{r:[20,30,20],opacity:[.3,0,.3],cx:s.x,cy:s.y},transition:{r:{duration:2,repeat:1/0},opacity:{duration:2,repeat:1/0},cx:{duration:.6,ease:"easeInOut"},cy:{duration:.6,ease:"easeInOut"}}})]},e.id)})]})})]})})]})};export{ue as default};
